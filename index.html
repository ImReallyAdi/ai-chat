<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cookie Friend or Bully?</title>
  <style>
    :root {
      --primary: #fde6d5;
      --accent: #ffc87c;
      --dark: #8c5b3c;
      --text: #3e2b23;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background: var(--primary);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    header {
      background-color: var(--accent);
      padding: 1rem 2rem;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }

    header h1 {
      font-size: 2rem;
      color: var(--dark);
    }

    .game-box {
      width: 100%;
      max-width: 600px;
      background: #fff8f0;
      border: 2px solid var(--accent);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      text-align: center;
    }

    .question {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }

    .options button {
      padding: 0.75rem 1.5rem;
      margin: 0.5rem;
      border: none;
      background: var(--accent);
      color: var(--dark);
      font-weight: bold;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .options button:hover {
      background: #f5b55c;
    }

    .result {
      margin-top: 1.5rem;
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--dark);
    }

    #user-input-section {
      margin-top: 1rem;
    }

    #user-input-section input {
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 70%;
      margin-bottom: 0.5rem;
    }

    #user-input-section button {
      padding: 0.5rem 1rem;
      background: var(--accent);
      border: none;
      border-radius: 8px;
      color: var(--dark);
      font-weight: bold;
      cursor: pointer;
    }

    #continueSection {
      margin-top: 1rem;
    }

    #continueSection button {
      padding: 0.5rem 1.25rem;
      margin: 0.5rem;
      border: none;
      background: var(--accent);
      color: var(--dark);
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>üç™ Cookie Friend or Bully Game</h1>
  </header>
  <div class="game-box">
    <div class="question" id="question">
      Someone says: "You're so weird, no one likes you." Are they a friend or a bully?
    </div>
    <div class="options">
      <button onclick="checkAnswer('bully')">Bully</button>
      <button onclick="checkAnswer('friend')">Friend</button>
    </div>
    <div class="result" id="result"></div>

    <div id="user-input-section">
      <p>Want to say something back?</p>
      <input type="text" id="userMessage" placeholder="Type your message here" />
      <button onclick="sendUserMessage()">Send</button>
    </div>

    <div class="result" id="aiReply"></div>

    <div id="continueSection" style="display:none;">
      <p>Do you want to continue the game?</p>
      <button onclick="showQuestion()">Yes</button>
      <button onclick="stopGame()">No</button>
    </div>
  </div>

  <script>
    const KEY = 'YOUR_TOGETHER_API_KEY_HERE'; 
    const MODEL = 'meta-llama/Llama-3.370B-Instruct-Turbo-Free';

    let currentQuestion = null;
    let currentAnswer = null;

    async function fetchQuestion() {
      const prompt = `Generate a bullying or friendly statement for a children's game. Respond in JSON with keys 'text' and 'answer' (answer is either 'friend' or 'bully').`;
      const response = await fetch('https://api.together.xyz/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${KEY}`
        },
        body: JSON.stringify({
          model: MODEL,
          messages: [
            { role: 'system', content: 'You are a helpful assistant for a children\'s game.' },
            { role: 'user', content: prompt }
          ],
          max_tokens: 128,
          temperature: 0.7
        })
      });
      if (!response.ok) {
        throw new Error('Failed to fetch question');
      }
      const data = await response.json();
      let content = data.choices[0].message.content;
      try {
        return JSON.parse(content);
      } catch (e) {
        const match = content.match(/\{[\s\S]*\}/);
        if (match) return JSON.parse(match[0]);
        throw new Error('Invalid response format');
      }
    }

    async function showQuestion() {
      const questionDiv = document.getElementById('question');
      const resultDiv = document.getElementById('result');
      const aiReply = document.getElementById('aiReply');
      const continueSection = document.getElementById('continueSection');
      const userInput = document.getElementById('userMessage');
      const sendBtn = document.querySelector('#user-input-section button');

      questionDiv.textContent = 'Loading...';
      resultDiv.textContent = '';
      aiReply.textContent = '';
      continueSection.style.display = 'none';
      userInput.disabled = false;
      sendBtn.disabled = false;
      userInput.value = '';

      try {
        const q = await fetchQuestion();
        currentQuestion = q.text;
        currentAnswer = q.answer;
        questionDiv.textContent = `Someone says: "${currentQuestion}" Are they a friend or a bully?`;
      } catch (e) {
        questionDiv.textContent = 'Error loading question.';
      }
    }

    function checkAnswer(choice) {
      const result = document.getElementById('result');
      if (!currentAnswer) {
        result.textContent = 'No question loaded.';
        return;
      }
      if (choice === currentAnswer) {
        result.textContent = "‚úÖ Correct! That was a " + currentAnswer + ".";
      } else {
        result.textContent = "‚ùå Oops! That was a " + currentAnswer + ".";
      }
    }

    async function sendUserMessage() {
      const message = document.getElementById('userMessage').value.trim();
      const aiReply = document.getElementById('aiReply');

      if (!message) return;

      aiReply.textContent = "AI is thinking... ü§î";

      try {
        const response = await fetch('https://api.together.xyz/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${KEY}`
          },
          body: JSON.stringify({
            model: MODEL,
            messages: [
              { role: 'system', content: "You are a friendly assistant talking to a child about kindness and feelings. Respond in a supportive and simple way." },
              { role: 'user', content: message }
            ],
            max_tokens: 100,
            temperature: 0.6
          })
        });

        if (!response.ok) {
          throw new Error("AI response failed");
        }

        const data = await response.json();
        const reply = data.choices[0].message.content;
        aiReply.textContent = `ü§ñ AI says: ${reply}`;
      } catch (error) {
        aiReply.textContent = "‚ùå Sorry, I couldn't get a reply.";
      }

      // Disable input after one use
      document.getElementById('userMessage').disabled = true;
      document.querySelector('#user-input-section button').disabled = true;
      document.getElementById('continueSection').style.display = 'block';
    }

    function stopGame() {
      const questionDiv = document.getElementById('question');
      questionDiv.textContent = "Thanks for playing! üëã";
      document.querySelector('.options').style.display = 'none';
      document.getElementById('user-input-section').style.display = 'none';
      document.getElementById('continueSection').style.display = 'none';
      document.getElementById('result').textContent = '';
    }

    window.onload = showQuestion;
  </script>
</body>
</html>
